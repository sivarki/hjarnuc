<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script>
        function ConsoleKeyPressed(event) {
            if (document.activeElement.id != "console_input" || event.keyCode != 13)
                return;
            var content = document.getElementById("console_input").value;
            document.getElementById("console_input").value = "";
            if (content != "" && content[0] == '/')
                handleInputToConsole(content);
        }
        function handleInputToConsole(input) {
            var command_name = input.split(" ")[0].replace("/", "");
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText);
                    EnterConsoleContent(this.responseText);
                }
            };
            xhttp.open("GET", "/api/Command", true);
            xhttp.setRequestHeader("commandInput", input.replace("/", "").replace(command_name+" ", ""));
            xhttp.setRequestHeader("commandName", command_name);
            xhttp.send();
        }
        function EnterConsoleContent(content) {
            var CEW = document.getElementById("commandEntryWrapper");
            var snap_bottom = CEW.scrollTop/(CEW.scrollHeight - CEW.clientHeight);
            content = "<div class=\"commandEntry\">" + content + "</div>";
            CEW.insertAdjacentHTML("beforeend", content);
            console.log(snap_bottom);
            if(snap_bottom == 1)
                CEW.scrollTop = CEW.scrollHeight;
        }
    </script>
    <style>
        .commandContent {
             margin: 10px 10%; 
             width: 80%; 
        }
        .commandEntry {
            padding: 7px;
            font-size: large;
            font-family: monospace;
            border: 1px;
            border-style: outset;
            background-color: antiquewhite;
        }
    </style>
</head>
<body>
<div class="module">
    <h2 class="commandContent" >Command Console</h2>
    <p class="commandContent" >You can enter commands in the console below. You can view all available commands
        by typing '/help'.</p>
    <div id="console_box" class="commandContent" style="
                                          border: 1px;
                                          border-style: groove;overflow: hidden; position: relative; height: 400px; ">
        <div id="commandEntryWrapper"
             style="
             max-height: 100%;
             overflow-y: scroll;
             overflow-x: hidden;position: absolute; bottom: 0; width: 100%;">
            <div class="commandEntry">a command was executed.</div>
        </div>
    </div>
    <input id="console_input" class="commandContent" 
           onkeydown="ConsoleKeyPressed(event)"
           style="
       height: 30px;
       background-color: aliceblue;
       font-size: large;
       padding: 1px 7px;
       ">
</div>
</body>
</html>